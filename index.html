<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TBS Education - Évaluation IA Générative</title>
    <link rel="stylesheet" href="style.css">
    <!-- Chart.js pour graphes -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- QRCode pour génération code -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <!-- Firebase App (core) -->
    <script src="https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js"></script>
    <!-- Firebase Realtime Database -->
    <script src="https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js"></script>
</head>
<body>
    <div id="homepage" class="page active">
        <div class="container">
            <div class="homepage-header">
                <div class="logo">
                    <h1 class="logo-text">TBS Education</h1>
                    <p class="logo-subtitle">Évaluation IA Générative</p>
                </div>
            </div>

            <div class="homepage-content">
                <div class="role-selector">
                    <div class="role-card">
                        <h2>Formateur</h2>
                        <p>Créez et gérez vos sessions d'évaluation</p>
                        <button class="btn btn--primary" onclick="showTrainerInterface()">
                            Nouvelle Session
                        </button>
                    </div>

                    <div class="role-card">
                        <h2>Participant</h2>
                        <p>Rejoindre une session avec le code fourni</p>
                        <div class="participant-form">
                            <input type="text" id="participantName" placeholder="Votre nom" maxlength="50" class="form-control">
                            <input type="text" id="sessionCode" placeholder="Code session (6 chiffres)" maxlength="6" class="form-control">
                            <button class="btn btn--primary" onclick="joinSession()">Connexion</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Tableau de bord formateur -->
    <div id="trainerDashboard" class="page" style="display:none">
        <div class="container">
            <h2>Session - Participants connectés</h2>
            <div>
                <span id="sessionCodeDisplay"></span>
                <canvas id="participantsChart" width="400" height="200"></canvas>
            </div>
            <ul id="participantsList"></ul>
        </div>
    </div>
    <!-- Interface participant -->
    <div id="participantInterface" class="page" style="display:none">
        <div class="container">
            <h2 id="welcomeParticipant"></h2>
            <p>Connecté à la session <span id="participantSessionCode"></span></p>
        </div>
    </div>
    <!-- Script principal + Firebase -->
    <script>
        // Configurez selon vos propres clés du projet Firebase
        const firebaseConfig = {

  apiKey: "AIzaSyDQ9bo0kbURo8e2eKayUvEpDfA2Op7ff4g",

  authDomain: "evalia-309fb.firebaseapp.com",

  projectId: "evalia-309fb",

  storageBucket: "evalia-309fb.firebasestorage.app",

  messagingSenderId: "106922407163",

  appId: "1:106922407163:web:9bac7cf321378062196c5e"

};        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function showTrainerInterface() {
            let code = (Math.random() * 1e6).toFixed(0).padStart(6, '0');
            document.getElementById('homepage').style.display = 'none';
            document.getElementById('trainerDashboard').style.display = '';

            document.getElementById('sessionCodeDisplay').textContent = "Code de session : " + code;
            window.activeSessionCode = code;

            db.ref(`sessions/${code}/participants`).remove();
            db.ref(`sessions/${code}/participants`).on('value', snapshot => {
                const data = snapshot.val() || {};
                const list = document.getElementById('participantsList');
                list.innerHTML = '';
                let names = Object.values(data).map(x=>x.nom);
                names.forEach(name=>{
                    let li = document.createElement('li');
                    li.textContent = name;
                    list.appendChild(li);
                });
                // Graphique participants
                document.getElementById('participantsChart').style.display = '';
                const ctx = document.getElementById('participantsChart');
                if(window.chartInstance) window.chartInstance.destroy();
                window.chartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: { labels: names, datasets: [{ label: "Participants", data: names.map(()=>1), backgroundColor: "#ff3a52" }] },
                    options: { scales: { y: { beginAtZero: true } }}
                });
            });
        }

        function joinSession() {
            let nom = document.getElementById('participantName').value.trim();
            let code = document.getElementById('sessionCode').value.trim();
            if(!nom || !code || code.length !== 6) { alert("Nom et code obligatoires."); return; }
            document.getElementById('homepage').style.display = 'none';
            document.getElementById('participantInterface').style.display = '';
            document.getElementById('participantSessionCode').textContent = code;
            document.getElementById('welcomeParticipant').textContent = `Bienvenue ${nom}!`;
            db.ref(`sessions/${code}/participants`).push({ nom });
        }
    </script>
</body>
</html>
